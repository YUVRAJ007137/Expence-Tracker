<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa, #e0e7ff);
      min-height: 100vh;
      font-family: "Poppins", sans-serif;
    }

    .card {
      border: none;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .summary-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }

    .summary-card:hover {
      transform: scale(1.03);
    }

    table thead {
      background-color: #6f42c1;
      color: white;
    }

    .btn {
      border-radius: 10px;
    }

    @media (max-width: 768px) {
      .form-label {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body class="p-3">
  <div class="container my-4">
    <h2 class="text-center mb-4 text-primary fw-bold">
      ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä | Expense Tracker
    </h2>

    <!-- Summary -->
    <div class="row mb-4 text-center g-3">
      <div class="col-md-4 col-sm-12">
        <div class="summary-card p-3">
          <h5 class="text-primary fw-bold">‡§è‡§ï‡•Ç‡§£ ‡§ñ‡§∞‡•ç‡§ö / Total:</h5>
          <h3 id="totalOverall" class="fw-bold">‚Çπ0</h3>
        </div>
      </div>
      <div class="col-md-4 col-sm-12">
        <div class="summary-card p-3">
          <h5 class="text-success fw-bold">‡§≠‡§∞‡§≤‡•á‡§≤‡•á / Paid:</h5>
          <h3 id="totalPaid" class="fw-bold">‚Çπ0</h3>
        </div>
      </div>
      <div class="col-md-4 col-sm-12">
        <div class="summary-card p-3">
          <h5 class="text-danger fw-bold">‡§¨‡§æ‡§ï‡•Ä / Pending:</h5>
          <h3 id="totalPending" class="fw-bold">‚Çπ0</h3>
        </div>
      </div>
    </div>

    <!-- Form -->
    <form id="expenseForm" class="card p-4 mb-4">
      <h4 class="mb-3 text-secondary">‡§®‡§µ‡•Ä‡§® ‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§æ / Add New Expense</h4>
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡•Ä / Merchant Name</label>
          <input type="text" id="merchant" class="form-control" placeholder="Enter merchant name" required />
        </div>

        <div class="col-md-4">
          <label class="form-label">‡§§‡§æ‡§∞‡•Ä‡§ñ / Date</label>
          <input type="date" id="date" class="form-control" required />
        </div>

        <div class="col-md-4">
          <label class="form-label">‡§Ö‚Äç‡•Ö‡§°‡§µ‡•ç‡§π‡§æ‡§®‡•ç‡§∏ ‡§∞‡§ï‡•ç‡§ï‡§Æ / Advance Paid (‚Çπ)</label>
          <input type="number" id="advance" class="form-control" placeholder="0" />
        </div>

        <div class="col-md-4">
          <label class="form-label">‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ / Total Amount (‚Çπ)</label>
          <input type="number" id="total" class="form-control" placeholder="0" required />
        </div>

        <div class="col-md-4">
          <label class="form-label">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ / Payment Mode</label>
          <select id="mode" class="form-select">
            <option value="Cash">Cash</option>
            <option value="UPI">UPI</option>
            <option value="Card">Card</option>
          </select>
        </div>

        <div class="col-md-12">
          <button type="submit" class="btn btn-primary mt-3 w-100">‡§ñ‡§∞‡•ç‡§ö ‡§ú‡•ã‡§°‡§æ / Add Expense</button>
        </div>
      </div>
    </form>

    <!-- Table -->
    <div class="card p-3">
      <h4 class="mb-3 text-secondary">‡§∏‡§∞‡•ç‡§µ ‡§ñ‡§∞‡•ç‡§ö / All Expenses</h4>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center">
          <thead>
            <tr>
              <th>‡§§‡§æ‡§∞‡•Ä‡§ñ / Date</th>
              <th>‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡•Ä / Merchant</th>
              <th>‡§è‡§ï‡•Ç‡§£ / Total</th>
              <th>‡§Ö‚Äç‡•Ö‡§°‡§µ‡•ç‡§π‡§æ‡§®‡•ç‡§∏ / Advance</th>
              <th>‡§¨‡§æ‡§ï‡•Ä / Remaining</th>
              <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ / Mode</th>
              <th>‡§∏‡•ç‡§•‡§ø‡§§‡•Ä / Status</th>
              <th>‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ / Action</th>
            </tr>
          </thead>
          <tbody id="expenseTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("expenseForm");
      const tableBody = document.getElementById("expenseTableBody");
      const totalPaidEl = document.getElementById("totalPaid");
      const totalPendingEl = document.getElementById("totalPending");
      const totalOverallEl = document.getElementById("totalOverall");

      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

      function formatDate(dateStr) {
        if (!dateStr) return "";
        if (dateStr.includes("-")) {
          const [year, month, day] = dateStr.split("-");
          return `${day}-${month}-${year}`;
        } else if (dateStr.includes("/")) {
          const parts = dateStr.split("/");
          if (parts[0].length === 4) return `${parts[2]}-${parts[1]}-${parts[0]}`;
          else return `${parts[1]}-${parts[0]}-${parts[2]}`;
        } else if (dateStr.includes("T")) {
          const d = new Date(dateStr);
          return d.toLocaleDateString("en-GB");
        }
        return dateStr;
      }

      function saveData() {
        localStorage.setItem("expenses", JSON.stringify(expenses));
      }

      function updateTotals() {
        let totalPaid = 0;
        let totalPending = 0;

        expenses.forEach((exp) => {
          if (exp.status === "Paid") {
            totalPaid += exp.total;
          } else {
            totalPending += exp.remaining;
          }
        });

        const totalOverall = totalPaid + totalPending;
        totalPaidEl.textContent = `‚Çπ${totalPaid}`;
        totalPendingEl.textContent = `‚Çπ${totalPending}`;
        totalOverallEl.textContent = `‚Çπ${totalOverall}`;
      }

      function renderTable() {
        tableBody.innerHTML = "";
        // üü¢ Show newer entries first
        const reversedExpenses = [...expenses].reverse();

        reversedExpenses.forEach((exp, revIndex) => {
          const index = expenses.length - 1 - revIndex;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${formatDate(exp.date)}</td>
            <td>${exp.merchant}</td>
            <td>‚Çπ${exp.total}</td>
            <td>‚Çπ${exp.advance}</td>
            <td>‚Çπ${exp.remaining}</td>
            <td>${exp.mode}</td>
            <td>
              <span class="badge ${exp.status === "Paid" ? "bg-success" : "bg-warning text-dark"}">
                ${exp.status}
              </span>
            </td>
            <td>
              <button class="btn btn-danger btn-sm me-1" onclick="deleteExpense(${index})">Delete</button>
              ${
                exp.status === "Pending"
                  ? `<button class="btn btn-success btn-sm" onclick="markPaid(${index})">Paid</button>`
                  : `<button class="btn btn-secondary btn-sm" onclick="undoPaid(${index})">Undo</button>`
              }
            </td>
          `;
          tableBody.appendChild(row);
        });
        updateTotals();
      }

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const dateInput = document.getElementById("date").value;
        const merchant = document.getElementById("merchant").value.trim();
        const total = parseFloat(document.getElementById("total").value) || 0;
        const advance = parseFloat(document.getElementById("advance").value) || 0;
        const mode = document.getElementById("mode").value;

        if (!merchant || !total) {
          alert("Please fill in all required fields.");
          return;
        }

        const remaining = total - advance;
        const date = formatDate(dateInput);

        const newExpense = {
          date,
          merchant,
          total,
          advance,
          remaining,
          mode,
          status: "Pending",
        };

        expenses.push(newExpense);
        saveData();
        renderTable();
        form.reset();
      });

      window.deleteExpense = function (index) {
        if (confirm("Delete this expense?")) {
          expenses.splice(index, 1);
          saveData();
          renderTable();
        }
      };

      window.markPaid = function (index) {
        expenses[index].status = "Paid";
        saveData();
        renderTable();
      };

      window.undoPaid = function (index) {
        expenses[index].status = "Pending";
        saveData();
        renderTable();
      };

      renderTable();
    });
  </script>
</body>
</html>
