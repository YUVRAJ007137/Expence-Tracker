<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa, #e0e7ff);
      min-height: 100vh;
      font-family: "Poppins", sans-serif;
    }

    .card {
      border: none;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .summary-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }

    .summary-card:hover {
      transform: scale(1.03);
    }

    table thead {
      background-color: #6f42c1;
      color: white;
    }

    .btn {
      border-radius: 10px;
    }

    @media (max-width: 768px) {
      .form-label {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body class="p-3">
  <div class="container my-4">
    <h2 class="text-center mb-4 text-primary fw-bold">
    खर्च व्यवस्थापन प्रणाली | Expense Tracker
    </h2>

    <!-- Summary -->
    <div class="row mb-4 text-center">
      <div class="col-md-6 mb-2">
        <div class="summary-card p-3">
          <h5 class="text-success fw-bold">एकूण भरलेले / Total Paid:</h5>
          <h3 id="totalPaid" class="fw-bold">₹0</h3>
        </div>
      </div>
      <div class="col-md-6 mb-2">
        <div class="summary-card p-3">
          <h5 class="text-danger fw-bold">बाकी रक्कम / Pending:</h5>
          <h3 id="totalPending" class="fw-bold">₹0</h3>
        </div>
      </div>
    </div>

    <!-- Form -->
    <div class="card p-4 mb-4">
      <h4 class="mb-3 text-secondary">नवीन खर्च जोडा / Add New Expense</h4>
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">व्यापारी / Merchant Name</label>
          <input type="text" id="merchant" class="form-control" placeholder="Enter merchant name" />
        </div>

        <div class="col-md-4">
          <label class="form-label">अ‍ॅडव्हान्स रक्कम / Advance Paid (₹)</label>
          <input type="number" id="advance" class="form-control" placeholder="0" />
        </div>

        <div class="col-md-4">
          <label class="form-label">एकूण रक्कम / Total Amount (₹)</label>
          <input type="number" id="total" class="form-control" placeholder="0" />
        </div>

        <div class="col-md-4">
          <label class="form-label">पेमेंट प्रकार / Payment Mode</label>
          <select id="mode" class="form-select">
            <option value="Cash">Cash</option>
            <option value="UPI">UPI</option>
            <option value="Card">Card</option>
          </select>
        </div>

        <div class="col-md-12">
          <button id="addExpense" class="btn btn-primary mt-3 w-100">खर्च जोडा / Add Expense</button>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="card p-3">
      <h4 class="mb-3 text-secondary">सर्व खर्च / All Expenses</h4>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center">
          <thead>
            <tr>
              <th>तारीख / Date</th>
              <th>व्यापारी / Merchant</th>
              <th>एकूण / Total</th>
              <th>अ‍ॅडव्हान्स / Advance</th>
              <th>बाकी / Remaining</th>
              <th>प्रकार / Mode</th>
              <th>स्थिती / Status</th>
              <th>क्रिया / Action</th>
            </tr>
          </thead>
          <tbody id="expenseTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const merchant = document.getElementById("merchant");
    const advance = document.getElementById("advance");
    const total = document.getElementById("total");
    const mode = document.getElementById("mode");
    const addExpenseBtn = document.getElementById("addExpense");
    const expenseTable = document.getElementById("expenseTable");
    const totalPaidEl = document.getElementById("totalPaid");
    const totalPendingEl = document.getElementById("totalPending");

    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    function renderTable() {
      expenseTable.innerHTML = "";
      let totalPaid = 0;
      let totalPending = 0;

      expenses.forEach((exp, index) => {
        const remaining = exp.total - exp.advance;

        // ✅ Calculation logic updated:
        // Advance always adds to paid
        // Remaining adds to pending until fully paid
        if (exp.paid) {
          totalPaid += exp.total;
        } else {
          totalPaid += exp.advance;
          totalPending += remaining;
        }

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${exp.date}</td>
          <td>${exp.merchant}</td>
          <td>₹${exp.total}</td>
          <td>₹${exp.advance}</td>
          <td>₹${remaining}</td>
          <td>${exp.mode}</td>
          <td>
            <span class="badge ${exp.paid ? "bg-success" : "bg-warning text-dark"}">
              ${exp.paid ? "Paid" : "Pending"}
            </span>
          </td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="deleteExpense(${index})">Delete</button>
            <button class="btn ${exp.paid ? "btn-secondary" : "btn-success"} btn-sm" onclick="togglePaid(${index})">
              ${exp.paid ? "Undo" : "Paid"}
            </button>
          </td>
        `;
        expenseTable.appendChild(row);
      });

      totalPaidEl.textContent = `₹${totalPaid}`;
      totalPendingEl.textContent = `₹${totalPending}`;
      localStorage.setItem("expenses", JSON.stringify(expenses));
    }

    function deleteExpense(index) {
      expenses.splice(index, 1);
      renderTable();
    }

    function togglePaid(index) {
      expenses[index].paid = !expenses[index].paid;
      renderTable();
    }

    addExpenseBtn.addEventListener("click", () => {
      if (!merchant.value || !total.value) {
        alert("Please fill all required fields");
        return;
      }

      const date = new Date().toLocaleString();
      const newExpense = {
        merchant: merchant.value,
        date,
        advance: parseFloat(advance.value) || 0,
        total: parseFloat(total.value),
        mode: mode.value,
        paid: false,
      };

      expenses.push(newExpense);
      merchant.value = "";
      advance.value = "";
      total.value = "";
      renderTable();
    });

    renderTable();
  </script>
</body>
</html>
